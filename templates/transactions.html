{% extends "base.html" %}
{% block links %}
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/finances.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/transactions.css') }}">
{% endblock %}
{% block content %}
<div class="section-container">
    <div class="section-content">
        <h1>Transactions</h1>
        <a href="{{ url_for('add_transaction') }}" class="btn btn-primary">Add Transaction</a>
        <br><br>
        <table>
            <tr>
                <th>Date</th>
                <th>Amount</th>
                <th>Category</th>
                <th>Description</th>
                <th>Actions</th>
            </tr>
            {% for transaction in transactions %}
            <tr>
                <td>{{ transaction.Date.strftime('%Y-%m-%d') }}</td>
                <td>${{ "%.2f"|format(transaction.Amount) }}</td>
                <td>
                    {% if transaction.Category %}
                        {{ transaction.Category }}
                    {% else %}
                        <span>&#9866; &#9866; &#9866;</span>
                    {% endif %}
                </td>
                <td title="{{ transaction.Description or 'No description provided' }}">
                    {% if transaction.Description %}
                        {{ transaction.Description|truncate(20, true, '...') }}
                    {% else %}
                        <span>&#9866; &#9866; &#9866;</span>
                    {% endif %}
                </td>
                <td>
                    <button onclick="editTransaction({{ transaction.TransactionID }})" class="button-edit">Edit</button>
                    <button onclick="removeTransaction({{ transaction.TransactionID }})" class="button-remove">Remove</button>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5">No transactions found.</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>
<hr>
{% block script %}
<script>
    function editTransaction(transactionId) {
        window.location.href = '/edit_transaction/' + transactionId; // Redirect to the edit page
    }
    
    function removeTransaction(transactionId) {
        if (confirm('Are you sure you want to delete this transaction?')) {
            fetch(`/delete_transaction/${transactionId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                }
            }).then(response => {
                if (response.ok) {
                    window.location.reload(); // Reload the page to reflect the changes
                } else {
                    alert('Failed to delete the transaction.');
                }
            });
        }
    }
</script>    
{% endblock %}
{% endblock %}
